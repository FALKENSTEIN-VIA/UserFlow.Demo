
# ğŸ§  Entwickler-Merkzettel fÃ¼r das UserFlow-Projekt (Stand: 2025-05-03)

## âœ… Allgemein
- C# WebAPI-Projekt mit ASP.NET Core, Entity Framework Core, PostgreSQL, Identity, JWT + RefreshToken.
- VollstÃ¤ndige Multi-Tenancy via `CompanyId` in allen relevanten Entities.
- Soft Delete ist global aktiv via `IsDeleted` in `BaseEntity`.

---

## ğŸ¢ Firmen (Company)
- Die Entity `Company` erbt jetzt korrekt von `BaseEntity`.
- Globale Query-Filter auch fÃ¼r `Company` aktiv.
- DTOs: `CompanyDTO`, `CompanyCreateDTO`, `CompanyUpdateDTO`.
- Mappings vorhanden Ã¼ber `DTOMapper`.

---

## ğŸ‘¤ Benutzer (User / Employee)
- Identity-basiertes System mit `User : IdentityUser<long>`.
- `Employee` verknÃ¼pft `UserId` und `CompanyId`, Rolle wird als `string` gespeichert.
- `EmployeeConfiguration` definiert optionales FK-Verhalten wegen globaler Query-Filter.
- DTOs: `EmployeeDTO`, `EmployeeUpdateDTO`.
- Erweiterter `EmployeeController` mit folgenden Methoden:
  - `GetAllAsync()` â€“ Admin: alle, Manager: eigene Firma, User: 403
  - `GetById(id)`
  - `GetByCompany(companyId)`
  - `Create(EmployeeDTO)`
  - `Update(EmployeeUpdateDTO)`
  - `Delete(id)`

---

## ğŸ§± Datenstruktur (Entities)
- `Company` â†’ `Employee` â†’ `User`
- `User` â†’ `Project` â†’ `Screen` â†’ `ScreenAction`
- `Screen`, `ScreenAction`, `Note` tragen `CompanyId`, `UserId`, ggf. `ProjectId`.

---

## ğŸ§­ DTOMapper
- Mappings fÃ¼r alle Entities zu DTOs (auch Expressions fÃ¼r LINQ).
- Erweiterungen durchgefÃ¼hrt:
  - `Company`-Objekte (nicht nur ID) optional in DTOs eingebaut.
  - `Note` enthÃ¤lt `Title` (neu), zusÃ¤tzlich Projekt- und Screen-Namen.
  - Alle Screen- und ScreenActionDTOs enthalten `CompanyId`.

---

## ğŸŒ± DataSeeder
- Generiert:
  - 10 Companies
  - FÃ¼r jede Company:
    - 1 Admin (`admin.X@company.com`)
    - 2 Manager
    - 5 User
  - Pro Benutzer: 15 Projekte mit Screens und Actions.
- IDs konsistent vergeben:
  - CompanyId beginnt bei 1
  - Admin fÃ¼r CompanyId=1 hat `UserId = 2`
- `SeedInitialDataForUserAsync()` berÃ¼cksichtigt jetzt auch `CompanyId`.

---

## ğŸ” Auth / JWT
- `JwtService` erweitert: `CompanyId` wird jetzt im JWT als Claim eingebaut.
- `ICurrentUserService` nutzt diesen Claim zur Identifizierung des eingeloggten Nutzers.

---

## ğŸ› ï¸ AppDbContext
- Globale Filter (nur `IsDeleted`, keine dynamischen Company-Filter).
- Alle relevanten `EntityTypeConfiguration`-Klassen sind eingebunden:
  - `ProjectConfiguration`
  - `ScreenConfiguration`
  - `ScreenActionConfiguration`
  - `NoteConfiguration`
  - `ScreenActionTypeConfiguration`
  - `EmployeeConfiguration`
  - `AppUserConfiguration`
  - `CompanyConfiguration`

---

## ğŸ§ª Test-Login (Admin, CompanyId = 1)
- **E-Mail:** `admin.1@company.com`
- **Passwort:** `Test123!`
- Hat vollen Zugriff auf Projekte, Screens, Notes etc. seiner Firma.

---

## ğŸªµ Logging / Serilog
- StartvorgÃ¤nge, Migrationsstatus, Seeding-AblÃ¤ufe, Rollenvergabe und Fehler werden mit `ILogger` in Logfile geschrieben.
- Serilog-Ausgaben mit Templates wie: `ğŸš€`, `ğŸ‰`, `âš ï¸`, `ğŸ”¥`, etc.

---

## ğŸ“Œ Sonstiges
- Alle Queries mit `AsNoTracking()` im Controller.
- Alle Navigation Properties konfiguriert (inkl. `ScreenAction â†’ Project`, `Note â†’ Screen`, ...).
- Keine Shadow Properties mehr.
- Migration ist aktuell, keine neue Migration erforderlich nach letztem Umbau.
